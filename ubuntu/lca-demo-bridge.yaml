metadata:
    format: Lava-Test Test Definition 1.0
    name: lca-demo-bridge
    description: "LCA demp bridge part"
    maintainer:
        - vincent.hsu@linaro.org
    os:
        - ubuntu
    scope:
        - functional
    devices:
        - kvm
        - panda
        - panda-es
        - arndale
        - vexpress-a9
        - vexpress-tc2

install:
    steps:
        - 'git clone git://git.linaro.org/people/vincent.hsu/odp.git -b demo_v4'
        - 'cd odp'
        - 'make'
        - 'cd ..'
    deps:
        - flex
        - bison
        - git
        - build-essential

run:
    steps:
        - 'ifconfig -a'
        - 'route'
        - 'lava-network broadcast eth0'
        - 'lava-network collect eth0'
        - 'lava-sync ready'
        - 'ifconfig eth6 up'
        - 'ifconfig eth6 0.0.0.0'
        - 'ifconfig eth7 up'
        - 'ifconfig eth7 0.0.0.0'
        - 'cd odp/test/libpcap/tcpdump'
        - 'tcpdump -c 20 -n -i b:eth6,eth7 | tee ~/test.log'
        - 'cat ~/test.log'
        - 'if grep -i ip test.log ; then echo tcpdump:pass ; else echo tcpdump:fail ; fi'
        - 'tcpdump -w ~/test.pcap -c 20 -n -i b:eth6,eth7 > ~/test.log'
        - 'lava-test-run-attach ~/test.pcap text/plain'
        - 'lava-sync done'

parse:
    pattern: "^(?P<test_case_id>[a-zA-Z0-9_-]+):\\s(?P<result>\\w+)"
    fixupdict:
        PASS: pass
        FAIL: fail
