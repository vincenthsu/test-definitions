metadata:
    name: "lca-demo"
    format: "Lava-Test Test Definition 1.0"
    description: "LCA demo generator part"
    maintainer:
        - vincent.hsu@linaro.org
    os:
        - ubuntu
    scope:
        - functional
    devices:
        - kvm
        - panda
        - panda-es
        - arndale
        - vexpress-a9
        - vexpress-tc2
        - lng-arndale
        - lng-keystone

params:
    TEST_TIME: "600"
    TEST_INTERFACE: "eth1"
    KEYSTONE_MAC: "c4:ed:ba:99:f4:0a"
    ARNDALE_MAC: "78:78:78:87:87:87"

install:
    deps:
        - flex
        - bison
        - git
        - build-essential

run:
    steps:
        - "lava-network broadcast eth0"
        - "lava-network collect eth0"
        - "ifconfig -a"
        - "arp -a"
        - "route"
        - "CUR_PATH=$PWD"
        - "cd ~ ; git clone git://git.linaro.org/people/vincent.hsu/odp-demo.git -b keystone"
        - "cd ~/odp-demo ; make"
        - "cd $CUR_PATH"
        - "lava-sync ready"
        - "lava-test-case multinode-lava-network --shell ./common/scripts/lca-demo-generator.sh $TEST_TIME $TEST_INTERFACE $KEYSTONE_MAC $ARNDALE_MAC"
        - "lava-sync done"
        - "lava-test-run-attach ~/gen.log text/plain"
        - "lava-test-run-attach ~/recv.log text/plain"

parse:
    pattern: "^(?P<test_case_id>[a-zA-Z0-9_-]+):\\s(?P<result>\\w+)"
    fixupdict:
        PASS: pass
        FAIL: fail
